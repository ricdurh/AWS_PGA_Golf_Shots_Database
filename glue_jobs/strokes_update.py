import sys
from awsglue.transforms import *
from awsglue.utils import getResolvedOptions
from pyspark.context import SparkContext
from awsglue.context import GlueContext
from awsglue.job import Job
from awsglue import DynamicFrame

args = getResolvedOptions(sys.argv, ["JOB_NAME"])
sc = SparkContext()
glueContext = GlueContext(sc)
spark = glueContext.spark_session
job = Job(glueContext)
job.init(args["JOB_NAME"], args)

# Script generated for node Amazon S3
AmazonS3_node1706894449265 = glueContext.create_dynamic_frame.from_options(
    format_options={
        "quoteChar": '"',
        "withHeader": True,
        "separator": ",",
        "optimizePerformance": False,
    },
    connection_type="s3",
    format="csv",
    connection_options={
        "paths": ["s3://pga-tournament-data/strokes_df_updated.csv"],
        "recurse": True,
    },
    transformation_ctx="AmazonS3_node1706894449265",
)

# Script generated for node Amazon Redshift
AmazonRedshift_node1706901772253 = glueContext.write_dynamic_frame.from_options(
    frame=AmazonS3_node1706894449265,
    connection_type="redshift",
    connection_options={
        "postactions": "BEGIN; MERGE INTO public.strokes USING public.strokes_temp_6ydv71 ON strokes.tournament_player_shot = strokes_temp_6ydv71.tournament_player_shot WHEN MATCHED THEN UPDATE SET playerLastName = strokes_temp_6ydv71.playerLastName, playerId = strokes_temp_6ydv71.playerId, tournamentId = strokes_temp_6ydv71.tournamentId, courseId = strokes_temp_6ydv71.courseId, local_teetime = strokes_temp_6ydv71.local_teetime, startTee = strokes_temp_6ydv71.startTee, round_num = strokes_temp_6ydv71.round_num, holeNumber = strokes_temp_6ydv71.holeNumber, displayHole = strokes_temp_6ydv71.displayHole, par = strokes_temp_6ydv71.par, status = strokes_temp_6ydv71.status, score = strokes_temp_6ydv71.score, fairwayCenterX = strokes_temp_6ydv71.fairwayCenterX, fairwayCenterY = strokes_temp_6ydv71.fairwayCenterY, fairwayCenterZ = strokes_temp_6ydv71.fairwayCenterZ, teeOverviewX = strokes_temp_6ydv71.teeOverviewX, teeOverviewY = strokes_temp_6ydv71.teeOverviewY, teeOverviewZ = strokes_temp_6ydv71.teeOverviewZ, pinOverviewX = strokes_temp_6ydv71.pinOverviewX, pinOverviewY = strokes_temp_6ydv71.pinOverviewY, pinOverviewZ = strokes_temp_6ydv71.pinOverviewZ, yardage = strokes_temp_6ydv71.yardage, videoId = strokes_temp_6ydv71.videoId, distance = strokes_temp_6ydv71.distance, distanceRemaining = strokes_temp_6ydv71.distanceRemaining, toLocationCode = strokes_temp_6ydv71.toLocationCode, fromLocationCode = strokes_temp_6ydv71.fromLocationCode, finalStroke = strokes_temp_6ydv71.finalStroke, showMarker = strokes_temp_6ydv71.showMarker, markerText = strokes_temp_6ydv71.markerText, playByPlay = strokes_temp_6ydv71.playByPlay, playByPlayLabel = strokes_temp_6ydv71.playByPlayLabel, strokeNumber = strokes_temp_6ydv71.strokeNumber, strokeType = strokes_temp_6ydv71.strokeType, fromX = strokes_temp_6ydv71.fromX, fromY = strokes_temp_6ydv71.fromY, fromZ = strokes_temp_6ydv71.fromZ, toX = strokes_temp_6ydv71.toX, toY = strokes_temp_6ydv71.toY, toZ = strokes_temp_6ydv71.toZ, actualFlightTime = strokes_temp_6ydv71.actualFlightTime, apexHeight = strokes_temp_6ydv71.apexHeight, ballSpeed = strokes_temp_6ydv71.ballSpeed, clubSpeed = strokes_temp_6ydv71.clubSpeed, smashFactor = strokes_temp_6ydv71.smashFactor, launchSpin = strokes_temp_6ydv71.launchSpin, ballTrajKind = strokes_temp_6ydv71.ballTrajKind, ballTraj_measTimeInt0 = strokes_temp_6ydv71.ballTraj_measTimeInt0, ballTraj_measTimeInt1 = strokes_temp_6ydv71.ballTraj_measTimeInt1, ballTraj_spinRateFit0 = strokes_temp_6ydv71.ballTraj_spinRateFit0, ballTraj_spinRateFit1 = strokes_temp_6ydv71.ballTraj_spinRateFit1, ballTraj_spinRateFit2 = strokes_temp_6ydv71.ballTraj_spinRateFit2, ballTraj_spinRateFit3 = strokes_temp_6ydv71.ballTraj_spinRateFit3, ballTraj_valTimeInt0 = strokes_temp_6ydv71.ballTraj_valTimeInt0, ballTraj_valTimeInt1 = strokes_temp_6ydv71.ballTraj_valTimeInt1, ballTraj_xFit0 = strokes_temp_6ydv71.ballTraj_xFit0, ballTraj_xFit1 = strokes_temp_6ydv71.ballTraj_xFit1, ballTraj_xFit2 = strokes_temp_6ydv71.ballTraj_xFit2, ballTraj_xFit3 = strokes_temp_6ydv71.ballTraj_xFit3, ballTraj_xFit4 = strokes_temp_6ydv71.ballTraj_xFit4, ballTraj_xFit5 = strokes_temp_6ydv71.ballTraj_xFit5, ballTraj_xFit6 = strokes_temp_6ydv71.ballTraj_xFit6, ballTraj_yFit0 = strokes_temp_6ydv71.ballTraj_yFit0, ballTraj_yFit1 = strokes_temp_6ydv71.ballTraj_yFit1, ballTraj_yFit2 = strokes_temp_6ydv71.ballTraj_yFit2, ballTraj_yFit3 = strokes_temp_6ydv71.ballTraj_yFit3, ballTraj_yFit4 = strokes_temp_6ydv71.ballTraj_yFit4, ballTraj_yFit5 = strokes_temp_6ydv71.ballTraj_yFit5, ballTraj_yFit6 = strokes_temp_6ydv71.ballTraj_yFit6, ballTraj_zFit0 = strokes_temp_6ydv71.ballTraj_zFit0, ballTraj_zFit1 = strokes_temp_6ydv71.ballTraj_zFit1, ballTraj_zFit2 = strokes_temp_6ydv71.ballTraj_zFit2, ballTraj_zFit3 = strokes_temp_6ydv71.ballTraj_zFit3, ballTraj_zFit4 = strokes_temp_6ydv71.ballTraj_zFit4, ballTraj_zFit5 = strokes_temp_6ydv71.ballTraj_zFit5, ballTraj_zFit6 = strokes_temp_6ydv71.ballTraj_zFit6, tournament_player_shot = strokes_temp_6ydv71.tournament_player_shot WHEN NOT MATCHED THEN INSERT VALUES (strokes_temp_6ydv71.playerLastName, strokes_temp_6ydv71.playerId, strokes_temp_6ydv71.tournamentId, strokes_temp_6ydv71.courseId, strokes_temp_6ydv71.local_teetime, strokes_temp_6ydv71.startTee, strokes_temp_6ydv71.round_num, strokes_temp_6ydv71.holeNumber, strokes_temp_6ydv71.displayHole, strokes_temp_6ydv71.par, strokes_temp_6ydv71.status, strokes_temp_6ydv71.score, strokes_temp_6ydv71.fairwayCenterX, strokes_temp_6ydv71.fairwayCenterY, strokes_temp_6ydv71.fairwayCenterZ, strokes_temp_6ydv71.teeOverviewX, strokes_temp_6ydv71.teeOverviewY, strokes_temp_6ydv71.teeOverviewZ, strokes_temp_6ydv71.pinOverviewX, strokes_temp_6ydv71.pinOverviewY, strokes_temp_6ydv71.pinOverviewZ, strokes_temp_6ydv71.yardage, strokes_temp_6ydv71.videoId, strokes_temp_6ydv71.distance, strokes_temp_6ydv71.distanceRemaining, strokes_temp_6ydv71.toLocationCode, strokes_temp_6ydv71.fromLocationCode, strokes_temp_6ydv71.finalStroke, strokes_temp_6ydv71.showMarker, strokes_temp_6ydv71.markerText, strokes_temp_6ydv71.playByPlay, strokes_temp_6ydv71.playByPlayLabel, strokes_temp_6ydv71.strokeNumber, strokes_temp_6ydv71.strokeType, strokes_temp_6ydv71.fromX, strokes_temp_6ydv71.fromY, strokes_temp_6ydv71.fromZ, strokes_temp_6ydv71.toX, strokes_temp_6ydv71.toY, strokes_temp_6ydv71.toZ, strokes_temp_6ydv71.actualFlightTime, strokes_temp_6ydv71.apexHeight, strokes_temp_6ydv71.ballSpeed, strokes_temp_6ydv71.clubSpeed, strokes_temp_6ydv71.smashFactor, strokes_temp_6ydv71.launchSpin, strokes_temp_6ydv71.ballTrajKind, strokes_temp_6ydv71.ballTraj_measTimeInt0, strokes_temp_6ydv71.ballTraj_measTimeInt1, strokes_temp_6ydv71.ballTraj_spinRateFit0, strokes_temp_6ydv71.ballTraj_spinRateFit1, strokes_temp_6ydv71.ballTraj_spinRateFit2, strokes_temp_6ydv71.ballTraj_spinRateFit3, strokes_temp_6ydv71.ballTraj_valTimeInt0, strokes_temp_6ydv71.ballTraj_valTimeInt1, strokes_temp_6ydv71.ballTraj_xFit0, strokes_temp_6ydv71.ballTraj_xFit1, strokes_temp_6ydv71.ballTraj_xFit2, strokes_temp_6ydv71.ballTraj_xFit3, strokes_temp_6ydv71.ballTraj_xFit4, strokes_temp_6ydv71.ballTraj_xFit5, strokes_temp_6ydv71.ballTraj_xFit6, strokes_temp_6ydv71.ballTraj_yFit0, strokes_temp_6ydv71.ballTraj_yFit1, strokes_temp_6ydv71.ballTraj_yFit2, strokes_temp_6ydv71.ballTraj_yFit3, strokes_temp_6ydv71.ballTraj_yFit4, strokes_temp_6ydv71.ballTraj_yFit5, strokes_temp_6ydv71.ballTraj_yFit6, strokes_temp_6ydv71.ballTraj_zFit0, strokes_temp_6ydv71.ballTraj_zFit1, strokes_temp_6ydv71.ballTraj_zFit2, strokes_temp_6ydv71.ballTraj_zFit3, strokes_temp_6ydv71.ballTraj_zFit4, strokes_temp_6ydv71.ballTraj_zFit5, strokes_temp_6ydv71.ballTraj_zFit6, strokes_temp_6ydv71.tournament_player_shot); DROP TABLE public.strokes_temp_6ydv71; END;",
        "redshiftTmpDir": "s3://aws-glue-assets-590183762855-us-east-2/temporary/",
        "useConnectionProperties": "true",
        "dbtable": "public.strokes_temp_6ydv71",
        "connectionName": "Redshift connection",
        "preactions": "CREATE TABLE IF NOT EXISTS public.strokes (playerLastName VARCHAR, playerId VARCHAR, tournamentId VARCHAR, courseId VARCHAR, local_teetime TIMESTAMP, startTee INTEGER, round_num INTEGER, holeNumber INTEGER, displayHole INTEGER, par INTEGER, status INTEGER, score INTEGER, fairwayCenterX DECIMAL, fairwayCenterY DECIMAL, fairwayCenterZ DECIMAL, teeOverviewX DECIMAL, teeOverviewY DECIMAL, teeOverviewZ DECIMAL, pinOverviewX DECIMAL, pinOverviewY DECIMAL, pinOverviewZ DECIMAL, yardage INTEGER, videoId VARCHAR, distance VARCHAR, distanceRemaining VARCHAR, toLocationCode VARCHAR, fromLocationCode VARCHAR, finalStroke VARCHAR, showMarker VARCHAR, markerText VARCHAR, playByPlay VARCHAR, playByPlayLabel VARCHAR, strokeNumber INTEGER, strokeType VARCHAR, fromX DECIMAL, fromY DECIMAL, fromZ DECIMAL, toX DECIMAL, toY DECIMAL, toZ DECIMAL, actualFlightTime INTEGER, apexHeight DECIMAL, ballSpeed DECIMAL, clubSpeed DECIMAL, smashFactor DECIMAL, launchSpin DECIMAL, ballTrajKind VARCHAR, ballTraj_measTimeInt0 DECIMAL, ballTraj_measTimeInt1 DECIMAL, ballTraj_spinRateFit0 DECIMAL, ballTraj_spinRateFit1 DECIMAL, ballTraj_spinRateFit2 DECIMAL, ballTraj_spinRateFit3 DECIMAL, ballTraj_valTimeInt0 DECIMAL, ballTraj_valTimeInt1 DECIMAL, ballTraj_xFit0 DECIMAL, ballTraj_xFit1 DECIMAL, ballTraj_xFit2 DECIMAL, ballTraj_xFit3 DECIMAL, ballTraj_xFit4 DECIMAL, ballTraj_xFit5 DECIMAL, ballTraj_xFit6 DECIMAL, ballTraj_yFit0 DECIMAL, ballTraj_yFit1 DECIMAL, ballTraj_yFit2 DECIMAL, ballTraj_yFit3 DECIMAL, ballTraj_yFit4 DECIMAL, ballTraj_yFit5 DECIMAL, ballTraj_yFit6 DECIMAL, ballTraj_zFit0 DECIMAL, ballTraj_zFit1 DECIMAL, ballTraj_zFit2 DECIMAL, ballTraj_zFit3 DECIMAL, ballTraj_zFit4 DECIMAL, ballTraj_zFit5 DECIMAL, ballTraj_zFit6 DECIMAL, tournament_player_shot VARCHAR); DROP TABLE IF EXISTS public.strokes_temp_6ydv71; CREATE TABLE public.strokes_temp_6ydv71 (playerLastName VARCHAR, playerId VARCHAR, tournamentId VARCHAR, courseId VARCHAR, local_teetime TIMESTAMP, startTee INTEGER, round_num INTEGER, holeNumber INTEGER, displayHole INTEGER, par INTEGER, status INTEGER, score INTEGER, fairwayCenterX DECIMAL, fairwayCenterY DECIMAL, fairwayCenterZ DECIMAL, teeOverviewX DECIMAL, teeOverviewY DECIMAL, teeOverviewZ DECIMAL, pinOverviewX DECIMAL, pinOverviewY DECIMAL, pinOverviewZ DECIMAL, yardage INTEGER, videoId VARCHAR, distance VARCHAR, distanceRemaining VARCHAR, toLocationCode VARCHAR, fromLocationCode VARCHAR, finalStroke VARCHAR, showMarker VARCHAR, markerText VARCHAR, playByPlay VARCHAR, playByPlayLabel VARCHAR, strokeNumber INTEGER, strokeType VARCHAR, fromX DECIMAL, fromY DECIMAL, fromZ DECIMAL, toX DECIMAL, toY DECIMAL, toZ DECIMAL, actualFlightTime INTEGER, apexHeight DECIMAL, ballSpeed DECIMAL, clubSpeed DECIMAL, smashFactor DECIMAL, launchSpin DECIMAL, ballTrajKind VARCHAR, ballTraj_measTimeInt0 DECIMAL, ballTraj_measTimeInt1 DECIMAL, ballTraj_spinRateFit0 DECIMAL, ballTraj_spinRateFit1 DECIMAL, ballTraj_spinRateFit2 DECIMAL, ballTraj_spinRateFit3 DECIMAL, ballTraj_valTimeInt0 DECIMAL, ballTraj_valTimeInt1 DECIMAL, ballTraj_xFit0 DECIMAL, ballTraj_xFit1 DECIMAL, ballTraj_xFit2 DECIMAL, ballTraj_xFit3 DECIMAL, ballTraj_xFit4 DECIMAL, ballTraj_xFit5 DECIMAL, ballTraj_xFit6 DECIMAL, ballTraj_yFit0 DECIMAL, ballTraj_yFit1 DECIMAL, ballTraj_yFit2 DECIMAL, ballTraj_yFit3 DECIMAL, ballTraj_yFit4 DECIMAL, ballTraj_yFit5 DECIMAL, ballTraj_yFit6 DECIMAL, ballTraj_zFit0 DECIMAL, ballTraj_zFit1 DECIMAL, ballTraj_zFit2 DECIMAL, ballTraj_zFit3 DECIMAL, ballTraj_zFit4 DECIMAL, ballTraj_zFit5 DECIMAL, ballTraj_zFit6 DECIMAL, tournament_player_shot VARCHAR);",
    },
    transformation_ctx="AmazonRedshift_node1706901772253",
)

job.commit()
